MIFOS SETUP IN MY LOCAL MACHINE


Gap analysus
1. Adding new lables to the presentaiton - for e.g branch hierarchy
2. Ability to assign org/role
3. Adding staffs
4. AAdding roles


Roles and permissions

SET GLOBAL sql_mode = '';

https://localhost:8443/fineract-provider/api/v1?tenantIdentifier=default


org.apache.fineract.portfolio.loanaccount.loanschedule.domain.AbstractLoanScheduleGenerator.updateAmortization(MathContext, LoanApplicationTerms, int, Money)


/fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/loanschedule/domain/LoanScheduleGenerator.java
/fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/loanschedule/domain/LoanScheduleGeneratorFactory.java
/fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/loanschedule/domain/DecliningBalanceInterestLoanScheduleGenerator.java
/fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/loanschedule/domain/FlatInterestLoanScheduleGenerator.java

https://192.168.1.108:8443/fineract-provider/api/v1/loans?


Loan submision
https://192.168.1.108:8443/fineract-provider/api/v1/loans/19?associations=all&exclude=guarantors,futureSchedule

The code that generates the schedule
1.LoansApiResource.calculateLoanScheduleOrSubmitLoanApplication(String, UriInfo, String)
	-calculationPlatformService.calculateLoanSchedule
		-LoanScheduleCalculationPlatformService.calculateLoanSchedule
			-LoanScheduleCalculationPlatformServiceImpl.calculateLoanSchedule
				-loanScheduleAssembler.assembleLoanScheduleFrom
					-loanScheduleAssembler.assembleLoanScheduleFrom
						-LoanScheduleGenerator loanScheduleGenerator = this.loanScheduleFactory.create(loanApplicationTerms.getInterestMethod());
						-


Createloan product
https://192.168.1.108:8443/fineract-provider/api/v1/loanproducts/template
org.apache.fineract.portfolio.loanproduct.api.LoanProductsApiResource.createLoanProduct(String)

org.apache.fineract.portfolio.loanproduct.domain.InterestMethod
org.apache.fineract.portfolio.loanproduct.service.LoanDropdownReadPlatformServiceImpl.retrieveLoanInterestTypeOptions()

loadsampledata.sql contains sql entty to create loan products

Ok the next step is to pick the right compatible version of  mifos components
1. Server
2. WebUi
3. Android Client

Currently when checked the fineract war file that I downloaded from mifosx site or where it tells the last meaningful 
release is 16.12.01.RELEASE. Sounds idiotic as it is based on the date

How did I bring Structure payment support in UI
1. EnumOptionData - added toString method
2. LoanProductsApiResource.java - added a sysout to indicate that this is a changed sourcecode
3. AmortizationMethod.java -  Added additional getter method - isWhiteSpace
	Previous version
		EQUAL_PRINCIPAL(0, "amortizationType.equal.principal"), //
		EQUAL_INSTALLMENTS(1, "amortizationType.equal.installments"), //
	    	INVALID(2, "amortizationType.invalid");
    	Current version
	    	WHITEPACE_INSTALLMENTS(0, "amortizationType.equal.whitepsace"),
	    	EQUAL_PRINCIPAL(1, "amortizationType.equal.principal"), 
	    	EQUAL_INSTALLMENTS(2, "amortizationType.equal.installments");




4. InterestMethod.java - Added additional type and removed invalid
5. LoanApplicationTerms
	-There were lot of places where the amortization method and interest method were accessed
	-Changed all of them to reflect the whitespace method
6. DefaultLoanScheduleGeneratorFactory.java
	-Removed invalid method and added whitespace methods
7. LoanEnumerations.java
	-Removed invalide method and added whitespace methods for both amortization and interesttypes
	-Line 267 and 288
8. build.grade-Added additional exclusion types for rat
	-.recommenders/**',	
	'.metadata/**',
9. gradle.properties
	-changed releaseVersion	

How am I trying to bring up the table in the loanproduct ui
1. I have made changes  CreateLoanProductController.js 
	- added a new function addLoanSchedule

2. Added a new table in createloanproduct.html
	-Added support to generate multiiple entrires	



GOOGLE CLOUD SETUP
0. Create a new user in google by the name - lasalle.su with password dhuruva#2909
1. I have taken up a 4 processor 16 gb machine - in asia region
2. Set up the gcloud for interaction by following instructions in
https://cloud.google.com/sdk/docs/quickstart-linux
3.gcloud init
4. gcloud auth list
5. gcloud auth login
6. gcloud documentation
	https://cloud.google.com/sdk/docs/
7. Interactive shel
	https://cloud.google.com/sdk/docs/interactive-gcloud

8. Logging into the machine
	gcloud compute --project "certain-gearbox-161011" ssh --zone "asia-east1-c" "dev-box-1"	
9. Byobu documentation
	http://byobu.co/documentation.html	


CREATING A NEW SUBNET FOR THE DBMC
	1. Install docker
		https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04

	2. sudo docker network create --subnet=172.18.0.0/16 dbmc-net	
	3. Installing mysql docker
		REFER - 
			1. my sql docker file in git hub for 5.7- https://github.com/docker-library/mysql/blob/eeb0c33dfcad3db46a0dfb24c352d2a1601c7667/5.7/Dockerfile
			2. Docker reference - https://hub.docker.com/_/mysql/
		DO - 
			3.1 I have cloned the mysql official 5.7.17 docker file into my github account. And followed it with updating the docker file with nettools update. And built the docker with 
				"git clone git@github.com:jpvelsamy/mysql.git"
				"sudo docker build -t dbmc/mysql:5.7.17 ."
			3.2 Setting up data folder for mysql  - do this as root user 
				sudo su
				mkdir -p /root/docker-data/mysql
				
			3.3 sudo docker run -it -h dbmc-mysql-node --ip 172.18.0.5 --add-host dbmc-appserver-node:172.18.0.2 --add-host dbmc-webserver-node:172.18.0.6 --net dbmc-net -v /root/docker-data/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=password -d dbmc/mysql:5.7.17

			3.3 Access the container using
				sudo docker exec -it --user root [container id] /bin/bash
			3.4 mysql -u root -ppassword
				CREATE DATABASE `mifosplatform-tenants`
				CREATE DATABASE `mifostenant-default`
			3.5 Add following machine names in /etc/host
				172.18.0.5 dbmc-mysql-node
				172.18.0.2 dbmc-appserver-node
				172.18.0.6 dbmc-webserver-node
			3.6  change the mysql password to root in build.grade
			3.7 change all localhost:3306 in build.grade using
				REF - http://vim.wikia.com/wiki/Search_and_replace
				%s/localhost:3306/dbmc-mysql-node:3306/gc
			3.8  Download and install java in landing machine
			curl -LO 'http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz' -H 'Cookie: oraclelicense=accept-securebackup-cookie' 
			sudo update-alternatives --install /usr/bin/java java /home/jpvel/jdk1.8.0_121/bin/java 1
			export JAVA_HOME=/home/jpvel/jdk1.8.0_121
			3.9 install the server database using the landing machine from workspace/incubator/fineract-provider
				./gradlew migrateTenantListDB -PdbName=mifosplatform-tenants
			3.10 Install the defaul tenant database
				1.  Go to mysql server - its running a docker instance so use either the byobu screen or do docker exec
				2.  Log into the database and use the server database
				UPDATE tenant_server_connections SET schema_server='dbmc-mysql-node', schema_password='password' WHERE schema_name='mifostenant-default';
				3. SET GLOBAL sql_mode = '';
				4.  ./gradlew migrateTenantDB -PdbName=mifostenant-default
		4. Installing tomcat
			1. Clone jpvelsamy/tomcat into Landingmachine
			2. Use tomcat 7/jre8 version - that means   you need to go to appropriate folder . do not use alpine for now
			sudo docker build -t dbmc/tomcat:7.0.75 .
			3. sudo docker run -it -h  dbmc-appserver-node --ip 172.18.0.2 --add-host dbmc-mysql-node:172.18.0.5 --add-host dbmc-webserver-node:172.18.0.6 --net dbmc-net -d dbmc/tomcat:7.0.75
			4. sudo docker exec -it --user root [container id] /bin/bash
			5. Create the keystore
				https://mifosforge.jira.com/wiki/display/docs/Mifos+X+Installation+on+Linux+-+Ubuntu+Server

				keytool -genkey -keyalg RSA -alias tomcat -keystore /usr/local/tomcat/tomcat.keystore
			6. wget http://central.maven.org/maven2/org/drizzle/jdbc/drizzle-jdbc/1.3/drizzle-jdbc-1.3.jar
		5. Building the app in landing machine
			cd workspace/incubator-fineract/fineract-provider
			./gradlew war
		6. Copy the war file
			sudo docker cp ./build/lib/fineract-provider.war <>:/usr/local/tomcat/webapps
		7. Clone the ui source code in the workspace folder
			git  clone git@github.com:jpvelsamy/community-app.git
		8. For now I am using grunt as the webserver and its not cool.
			docker pull node:7.7.1
			sudo docker run -it -h  dbmc-webserver-node --ip 172.18.0.6  --add-host dbmc-mysql-node:172.18.0.5 --add-host dbmc-appserver-node:172.18.0.2 --net dbmc-net -d node:7.7.1
			sudo docker exec -it --user root [container id] /bin/bash

			In Landing machine
			tar -cvzf community-app.tar.gz ./community-app/
			sudo docker cp ./community-app.tar.gz vibrant_hoover:/home/node/downloads
			
			In webserver
				npm config set prefix ~
			 	npm install -g bower
			 	npm install -g grunt-cli
   			  	~/bin/bower install
   			  	npm install
   			  Install vim in webserver through root
   			  update initialTasks.js with 
   			  var baseApiUrl = "https://dbmc-appserver-node:8443/fineract-provider/api/v1?tenantIdentifier=default";
   			  change Gruntfile.js to point to 0.0.0.0 instead of localhost
   			  ~/bin/grunt serve


   		9. In order to serve traffic to dbmc-webserver-node:9000 and dbcm-appserver-node:8443/8080, I am going to setup tinyproxy

NOTE -
In case if you want to cleanup the docker instances
	sudo docker ps -a -q>/tmp/containers.txt
	while read name; do sudo docker rm ${name}; done</tmp/containers.txt

